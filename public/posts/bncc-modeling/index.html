<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Classificador BNCC Pt.2 - LobData</title><meta name="Description" content="This is my cool site"><meta property="og:title" content="Classificador BNCC Pt.2" />
<meta property="og:description" content="Resolvemos criar um novo artigo para detalhar melhor o que foi feito na etapa de modelagem do projeto do Classificador BNCC. Assim conseguimos dar mais atenção e justificar algumas escolhas.
Cronograma de modelagem Nosso intuito foi buscar o melhor baseline para nosso problema, mapeando alguns universos de possibilidades, dentre modelos de machine learning e estratégias de transformação de texto em dado numérico.
Válido lembrar que o dado que está entrando nessa etapa do pipeline está &ldquo;limpo&rdquo;, ou seja, passou pelas etapas de pré-processamentos que julgamos necessárias." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.lobdata.com.br/posts/bncc-modeling/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-06-14T00:00:00+00:00" /><meta property="og:site_name" content="LOBData" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Classificador BNCC Pt.2"/>
<meta name="twitter:description" content="Resolvemos criar um novo artigo para detalhar melhor o que foi feito na etapa de modelagem do projeto do Classificador BNCC. Assim conseguimos dar mais atenção e justificar algumas escolhas.
Cronograma de modelagem Nosso intuito foi buscar o melhor baseline para nosso problema, mapeando alguns universos de possibilidades, dentre modelos de machine learning e estratégias de transformação de texto em dado numérico.
Válido lembrar que o dado que está entrando nessa etapa do pipeline está &ldquo;limpo&rdquo;, ou seja, passou pelas etapas de pré-processamentos que julgamos necessárias."/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://www.lobdata.com.br/posts/bncc-modeling/" /><link rel="prev" href="https://www.lobdata.com.br/posts/bncc-classifier/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Classificador BNCC Pt.2",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.lobdata.com.br\/posts\/bncc-modeling\/"
        },"genre": "posts","keywords": "Bag of words, TFIDF, N-Grams, Word2Vec, Data Science, NLP, Education","wordcount":  1204 ,
        "url": "https:\/\/www.lobdata.com.br\/posts\/bncc-modeling\/","datePublished": "2022-06-14T00:00:00+00:00","dateModified": "2022-06-14T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Luciano, Pedro, Will e Brisa"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="LobData">LOBData</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="LobData">LOBData</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Classificador BNCC Pt.2</h1><h2 class="single-subtitle">Modelagem</h2><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Luciano, Pedro, Will e Brisa</a></span>&nbsp;<span class="post-category">included in <a href="/categories/projetos/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Projetos</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-06-14">2022-06-14</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1204 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;6 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#cronograma-de-modelagem">Cronograma de modelagem</a></li>
    <li><a href="#importância-da-validação">Importância da validação</a></li>
    <li><a href="#pipelines">Pipelines</a>
      <ul>
        <li><a href="#bag-of-words">Bag Of Words</a></li>
        <li><a href="#n-grams">N-Grams</a></li>
        <li><a href="#tfidf">TFIDF</a></li>
        <li><a href="#word2vec">Word2Vec</a></li>
      </ul>
    </li>
    <li><a href="#tuning">Tuning</a></li>
    <li><a href="#conclusão">Conclusão</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Resolvemos criar um novo artigo para detalhar melhor o que foi feito na etapa de modelagem do projeto do <a href="https://www.lobdata.com.br/2022/06/08/classificador-bncc/" target="_blank" rel="noopener noreffer ">Classificador BNCC</a>. Assim conseguimos dar mais atenção e justificar algumas escolhas.</p>
<h2 id="cronograma-de-modelagem">Cronograma de modelagem</h2>
<p>Nosso intuito foi buscar o <strong>melhor baseline</strong> para nosso problema, mapeando alguns universos de possibilidades, dentre modelos de machine learning e estratégias de transformação de texto em dado numérico.</p>
<p>Válido lembrar que o dado que está entrando nessa etapa do pipeline está <em>&ldquo;limpo&rdquo;</em>, ou seja, passou pelas etapas de pré-processamentos que julgamos necessárias. Resumido abaixo:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;questions_clean&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">df</span><span class="p">[</span><span class="s2">&#34;questions&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cleaning</span><span class="o">.</span><span class="n">remove_html</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cleaning</span><span class="o">.</span><span class="n">remove_punctuation_2</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">cleaning</span><span class="o">.</span><span class="n">remove_italic_quotes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">cleaning</span><span class="o">.</span><span class="n">remove_open_quotes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">cleaning</span><span class="o">.</span><span class="n">remove_end_quotes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">cleaning</span><span class="o">.</span><span class="n">remove_italic_dquotes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">cleaning</span><span class="o">.</span><span class="n">remove_open_dquotes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">cleaning</span><span class="o">.</span><span class="n">remove_quote</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cleaning</span><span class="o">.</span><span class="n">remove_pt_stopwords</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cleaning</span><span class="o">.</span><span class="n">remove_en_stopwords</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">word_tokenize</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cleaning</span><span class="o">.</span><span class="n">remove_punctuation_2</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">)</span>
</span></span></code></pre></div><p>Em questão de modelos, utilizamos:</p>
<ul>
<li>Regressão Logística</li>
<li>Random Forest</li>
<li>LightGBM</li>
</ul>
<p>Além disso, para cada um dos modelos utilizamos diferentes tipos de feature engineering, apresentadas a seguir:</p>
<ul>
<li>Bag of words</li>
<li>TFIDF</li>
<li>N-grams</li>
<li>Word2Vec</li>
</ul>
<blockquote>
<p>OBS: Também tentamos utilizar o algorítimo de machine learning Gaussian Naive Bayes, mas por conta do mesmo não trabalhar com matriz esparsa (na implementação do Scikit-Learn), não tivemos recurso computacional para rodar o algorítimo. O dado como matriz não esparsa ocuparia +40 Gb em memória.</p>
</blockquote>
<h2 id="importância-da-validação">Importância da validação</h2>
<p>Como estamos trabalhando com <strong>múltiplas classes</strong> nos dois classificadores que estamos otimizando, e como também estamos buscando a solução <strong>mais robusta possível</strong>, é importante que utilizemos alguma estratégia de validação.</p>
<p>A biblioteca do <code>scikit-learn</code> oferece uma série métodos que podem ser utilizados para essa finalidade. Aqui, optamos por utilizar o <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.StratifiedKFold.html" target="_blank" rel="noopener noreffer "><code>StratifiedKFold</code></a> com 5 splits.</p>
<p>Esse método de validação preserva a proporção inicial de cada uma das classes envolvidas no target.</p>
<h2 id="pipelines">Pipelines</h2>
<p>Os baselines que irão ser utilizados abaixo foram configurados como o seguinte dicionário:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># baselines</span>
</span></span><span class="line"><span class="cl"><span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;rg_lg&#34;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;r_forest&#34;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;lgbm&#34;</span><span class="p">:</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Dessa forma, conseguimos iterar em cada um dos modelos e automatizar nossas avaliações.</p>
<h3 id="bag-of-words">Bag Of Words</h3>
<p>O BoW (Bag of Words), ou saco de palavras, é uma técnica onde criamos um dicionário de palavras que contemplam nosso dataset, e contamos onde cada uma delas está presente ou não.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://ichi.pro/assets/images/max/724/1*hLvya7MXjsSc3NS2SoLMEg.png"
        data-srcset="https://ichi.pro/assets/images/max/724/1*hLvya7MXjsSc3NS2SoLMEg.png, https://ichi.pro/assets/images/max/724/1*hLvya7MXjsSc3NS2SoLMEg.png 1.5x, https://ichi.pro/assets/images/max/724/1*hLvya7MXjsSc3NS2SoLMEg.png 2x"
        data-sizes="auto"
        alt="https://ichi.pro/assets/images/max/724/1*hLvya7MXjsSc3NS2SoLMEg.png"
        title="bow" /></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kfold</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2020</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">val_idx</span> <span class="ow">in</span> <span class="n">kfold</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">modeling</span><span class="o">.</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&#34;questions_clean&#34;</span><span class="p">],</span> <span class="n">modeling</span><span class="o">.</span><span class="n">y_train</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">modeling</span><span class="o">.</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&#34;questions_clean&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">modeling</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">modeling</span><span class="o">.</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&#34;questions_clean&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_idx</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">modeling</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_idx</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># this will make our bag of words strategy</span>
</span></span><span class="line"><span class="cl">        <span class="n">count_vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">count_vectorizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">X_train_cv</span> <span class="o">=</span> <span class="n">count_vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">X_val_cv</span> <span class="o">=</span> <span class="n">count_vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># lgbm does not work with int type of data, so</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># we need to convert to float to use</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&#34;lgbm&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">X_train_cv</span> <span class="o">=</span> <span class="n">X_train_cv</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float32&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">X_val_cv</span> <span class="o">=</span> <span class="n">X_val_cv</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float32&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float32&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">y_val</span> <span class="o">=</span> <span class="n">y_val</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float32&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cv_classifier</span> <span class="o">=</span> <span class="n">model</span>
</span></span><span class="line"><span class="cl">        <span class="n">cv_classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_cv</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">cv_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_cv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&#34;macro&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Model: </span><span class="si">{}</span><span class="s2">. Macro avg F1: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f1</span><span class="p">))</span>
</span></span></code></pre></div><p>Resultados abaixo:</p>
<table>
<thead>
<tr>
<th>Modelos</th>
<th>Macro Avg F1</th>
</tr>
</thead>
<tbody>
<tr>
<td>Regressão Logística</td>
<td>0.743 +/- 0.03</td>
</tr>
<tr>
<td>Random Forest</td>
<td>0.657 +/- 0.05</td>
</tr>
<tr>
<td>LightGBM</td>
<td>0.745 +/- 0.002</td>
</tr>
</tbody>
</table>
<h3 id="n-grams">N-Grams</h3>
<p>Esta técnica visa realizar o agrupamento de tokens. O tamanho desse agrupamento é escolhido pelo valor do <em>N</em>:</p>
<ul>
<li>Uni: agrupamento um a um</li>
<li>Bi: agrupamento dois a dois</li>
<li>Tri: agrupamento três a três</li>
<li>&hellip;</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://images.deepai.org/glossary-terms/867de904ba9b46869af29cead3194b6c/8ARA1.png"
        data-srcset="https://images.deepai.org/glossary-terms/867de904ba9b46869af29cead3194b6c/8ARA1.png, https://images.deepai.org/glossary-terms/867de904ba9b46869af29cead3194b6c/8ARA1.png 1.5x, https://images.deepai.org/glossary-terms/867de904ba9b46869af29cead3194b6c/8ARA1.png 2x"
        data-sizes="auto"
        alt="https://images.deepai.org/glossary-terms/867de904ba9b46869af29cead3194b6c/8ARA1.png"
        title="n-grams" /></p>
<p>O interessante aqui é que conseguimos pegar um pouco de contexto, já que algumas palavras normalmente aparecem acompanhdas de outras. Por exemplo: <em>Pedro Álvares Cabral</em>, <em>Papai Noel</em>, <em>bom dia</em>&hellip;</p>
<p>Aqui nós utilizamos duas abordagens:</p>
<ul>
<li>Somente bi-gram</li>
<li>uni-gram + bi-gram</li>
</ul>
<p>Como podemos ver no código abaixo:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kfold</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2020</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">val_idx</span> <span class="ow">in</span> <span class="n">kfold</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">modeling</span><span class="o">.</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&#34;questions_clean&#34;</span><span class="p">],</span> <span class="n">modeling</span><span class="o">.</span><span class="n">y_train</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">modeling</span><span class="o">.</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&#34;questions_clean&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">modeling</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">modeling</span><span class="o">.</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&#34;questions_clean&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_idx</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">modeling</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_idx</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># the param ngram_range is responsible to set</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># how we&#39;ll want the n-grams. (1, 2) is setting</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># to bring uni and bi-gram combination.</span>
</span></span><span class="line"><span class="cl">        <span class="n">count_vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">count_vectorizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">X_train_cv</span> <span class="o">=</span> <span class="n">count_vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">X_val_cv</span> <span class="o">=</span> <span class="n">count_vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&#34;lgbm&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">X_train_cv</span> <span class="o">=</span> <span class="n">X_train_cv</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float32&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">X_val_cv</span> <span class="o">=</span> <span class="n">X_val_cv</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float32&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float32&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">y_val</span> <span class="o">=</span> <span class="n">y_val</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float32&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cv_classifier</span> <span class="o">=</span> <span class="n">model</span>
</span></span><span class="line"><span class="cl">        <span class="n">cv_classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_cv</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">cv_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_cv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&#34;macro&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># print(&#39;ROC AUC - {}: {}&#39;.format(name, mean))</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Model: </span><span class="si">{}</span><span class="s2">. Macro avg F1: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f1</span><span class="p">))</span>
</span></span></code></pre></div><p>Resultados apenas para o uni-gram + bi-gram:</p>
<table>
<thead>
<tr>
<th>Modelos</th>
<th>Macro Avg F1</th>
</tr>
</thead>
<tbody>
<tr>
<td>Regressão Logística</td>
<td>0.739 +/- 0.03</td>
</tr>
<tr>
<td>Random Forest</td>
<td>0.652 +/- 0.05</td>
</tr>
<tr>
<td>LightGBM</td>
<td>0.729 +/- 0.003</td>
</tr>
</tbody>
</table>
<h3 id="tfidf">TFIDF</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://miro.medium.com/max/1200/1*qQgnyPLDIkUmeZKN2_ZWbQ.png"
        data-srcset="https://miro.medium.com/max/1200/1*qQgnyPLDIkUmeZKN2_ZWbQ.png, https://miro.medium.com/max/1200/1*qQgnyPLDIkUmeZKN2_ZWbQ.png 1.5x, https://miro.medium.com/max/1200/1*qQgnyPLDIkUmeZKN2_ZWbQ.png 2x"
        data-sizes="auto"
        alt="https://miro.medium.com/max/1200/1*qQgnyPLDIkUmeZKN2_ZWbQ.png"
        title="tfidf" /></p>
<p>Como pode ser visto na imagem acima, aqui nós conseguimos identificar o quão importante cada palavra é, em relação ao todo que estamos tentando prever. Por exemplo: <em>quantas vezes a palavra soma aparece no texto de uma questão de matemática, frente a quantidade de vezes que ela aparece em todas as questões de matemática que temos na base?</em></p>
<p>Utilizamos para isso, o código abaixo:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kfold</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2020</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">val_idx</span> <span class="ow">in</span> <span class="n">kfold</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">modeling</span><span class="o">.</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&#34;questions_clean&#34;</span><span class="p">],</span> <span class="n">modeling</span><span class="o">.</span><span class="n">y_train</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">modeling</span><span class="o">.</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&#34;questions_clean&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">modeling</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">modeling</span><span class="o">.</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&#34;questions_clean&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_idx</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">modeling</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_idx</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># here we are performing tfidf on training data</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># and choosing n-grams of 1 and 2</span>
</span></span><span class="line"><span class="cl">        <span class="n">tfidf</span> <span class="o">=</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">tfidf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">X_train_cv</span> <span class="o">=</span> <span class="n">tfidf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">X_val_cv</span> <span class="o">=</span> <span class="n">tfidf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&#34;lgbm&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">X_train_cv</span> <span class="o">=</span> <span class="n">X_train_cv</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float32&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">X_val_cv</span> <span class="o">=</span> <span class="n">X_val_cv</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float32&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float32&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">y_val</span> <span class="o">=</span> <span class="n">y_val</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float32&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cv_classifier</span> <span class="o">=</span> <span class="n">model</span>
</span></span><span class="line"><span class="cl">        <span class="n">cv_classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_cv</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">cv_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_cv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&#34;macro&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Model: </span><span class="si">{}</span><span class="s2">. Macro avg F1: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f1</span><span class="p">))</span>
</span></span></code></pre></div><p>Resultados apenas para o uni-gram + bi-gram::</p>
<table>
<thead>
<tr>
<th>Modelos</th>
<th>Macro Avg F1</th>
</tr>
</thead>
<tbody>
<tr>
<td>Regressão Logística</td>
<td>0.7151 +/- 0.006</td>
</tr>
<tr>
<td>Random Forest</td>
<td>0.6609 +/- 0.010</td>
</tr>
<tr>
<td>LightGBM</td>
<td>0.7230 +/- 0.007</td>
</tr>
</tbody>
</table>
<h3 id="word2vec">Word2Vec</h3>
<p>Esse é modelo de <em>word embeddings</em>. Esse tipo de representação de texto busca identificar o significado de uma palavra no seu contexto (conotação). O Word2Vec foi um dos primeiros a aplicar esse tipo de conceito.</p>
<p>Com o Word2vec, foi possível, por exemplo, realizar a interpretação abaixo:</p>
<p><em>King - Man + Woman = Queen</em></p>
<p>Com o Word2vec nós podemos contornar o problema de dimensionalidade, e representar um texto qualquer em um número de features pre-determinado que melhor capte o contexto analisado. Abaixo você pode ver como fizemos.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># creating the wv object</span>
</span></span><span class="line"><span class="cl"><span class="n">wv</span> <span class="o">=</span> <span class="n">Word2Vec</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">sentences</span><span class="o">=</span><span class="n">modeling</span><span class="o">.</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&#34;questions_clean&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">    <span class="n">vector_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">min_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">workers</span><span class="o">=</span><span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># function to transform those words</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">transforma_palavra</span><span class="p">(</span><span class="n">question</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">lista_vetores</span> <span class="o">=</span> <span class="p">[</span><span class="n">wv</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">get_vector</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">question</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lista_vetores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># applying to those questions</span>
</span></span><span class="line"><span class="cl"><span class="n">vetores_embeddings</span> <span class="o">=</span> <span class="n">modeling</span><span class="o">.</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&#34;questions_clean&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">transforma_palavra</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Criando um Dataframe com os resultados</span>
</span></span><span class="line"><span class="cl"><span class="n">df_embeddings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">vetores_embeddings</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">vetores_embeddings</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Definindo os nomes das colunas</span>
</span></span><span class="line"><span class="cl"><span class="n">df_embeddings</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;embedding_&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Vamos também trazer o tweet original e o sentimento</span>
</span></span><span class="line"><span class="cl"><span class="n">df_embeddings</span><span class="p">[</span><span class="s2">&#34;question&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modeling</span><span class="o">.</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&#34;questions_clean&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df_embeddings</span><span class="p">[</span><span class="s2">&#34;question_target&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modeling</span><span class="o">.</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&#34;target&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># splitting those embeddings</span>
</span></span><span class="line"><span class="cl"><span class="n">X_emb</span> <span class="o">=</span> <span class="n">df_embeddings</span><span class="p">[</span><span class="n">df_embeddings</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="mi">100</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">y_emb</span> <span class="o">=</span> <span class="n">df_embeddings</span><span class="o">.</span><span class="n">question_target</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">X_train_emb</span><span class="p">,</span> <span class="n">X_test_emb</span><span class="p">,</span> <span class="n">y_train_emb</span><span class="p">,</span> <span class="n">y_test_emb</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">X_emb</span><span class="p">,</span> <span class="n">y_emb</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_emb</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">nome</span><span class="p">,</span> <span class="n">modelo</span> <span class="ow">in</span> <span class="n">modelos_teste</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">metrica</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">modelo</span><span class="p">,</span> <span class="n">X_train_emb</span><span class="p">,</span> <span class="n">y_train_emb</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&#34;f1_macro&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span></code></pre></div><table>
<thead>
<tr>
<th>Modelos</th>
<th>Macro Avg F1</th>
</tr>
</thead>
<tbody>
<tr>
<td>Regressão Logística</td>
<td>0.565</td>
</tr>
<tr>
<td>Random Forest</td>
<td>0.551</td>
</tr>
<tr>
<td>LightGBM</td>
<td>0.581</td>
</tr>
</tbody>
</table>
<h2 id="tuning">Tuning</h2>
<p>Após toda experimentação, vimos que o modelo mais promissor, em termos de métrica, tempo de processamento e simplicidade, foi a regressão logística em conjunto com o Bag of Words.</p>
<p>Daí em diante, realizamos o tuning do <em>parâmetro C</em> da regressão logística, e conseguimos subir a acurácia para 0.8 em média dentre as classes, para o modelo que realiza a classificação do <a href="https://www.lobdata.com.br/2022/06/08/classificador-bncc/" target="_blank" rel="noopener noreffer "><strong>segundo classificador</strong></a>.</p>
<blockquote>
<p>Além de ajustar o C, nós também retiramos o <code>class_balanced</code>, pois o mesmo estava prejudicando a performance.</p>
</blockquote>
<h2 id="conclusão">Conclusão</h2>
<p>Ainda existe muito espaço para melhoria do modelo e espaço para melhoria da aplicação como um todo. Continuaremos atualizando de acordo fomos avançado, <em>obrigado pela leitura.</em></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-06-14</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://www.lobdata.com.br/posts/bncc-modeling/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/bag-of-words/">Bag of words</a>,&nbsp;<a href="/tags/tfidf/">TFIDF</a>,&nbsp;<a href="/tags/n-grams/">N-Grams</a>,&nbsp;<a href="/tags/word2vec/">Word2Vec</a>,&nbsp;<a href="/tags/data-science/">Data Science</a>,&nbsp;<a href="/tags/nlp/">NLP</a>,&nbsp;<a href="/tags/education/">Education</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/bncc-classifier/" class="prev" rel="prev" title="Classificador BNCC"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Classificador BNCC</a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.114.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Luba</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://https-www-lobdata-com-br.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"search":{"algoliaAppID":"56XLI6KGAP","algoliaIndex":"lobdata","algoliaSearchKey":"d7c82e758baf996bfc63e0fffb1098fd","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
