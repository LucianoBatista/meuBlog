<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="LOB.DATA">
    <meta property="og:type" content="article">
    <meta property="og:image" content="https://www.lobdata.com.br/img/banner/beach_more_sea.jpg">

    
      <meta name="twitter:card" content="summary_large_image">
      <meta name="twitter:image" content="https://www.cedricscherer.com/img/banner/banner.png" >
    

    

    
      <meta name="title" content="Criando uma API Pronta para Produção com FastAPI - PT.4" />
      <meta property="og:title" content="Criando uma API Pronta para Produção com FastAPI - PT.4 - Luba" />
      <meta property="twitter:title" content="Criando uma API Pronta para Produção com FastAPI - PT.4 - Luba" />
      <meta property="twitter:text:title" content="Criando uma API Pronta para Produção com FastAPI - PT.4 - Luba" />
    

    
      <meta name="description" content="Blog by LuBa">
      <meta property="og:description" content="Blog by LuBa" />
      <meta property="twitter:description" content="Blog by LuBa" />
    

    

    <meta name="keyword"  content="Data Visualization, Data Science, Programming, Web Development">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>Criando uma API Pronta para Produção com FastAPI - PT.4 - Luba</title>

    <link rel="canonical" href="/2021/04/08/criando-uma-api-pronta-para-produ%C3%A7%C3%A3o-com-fastapi-pt.4/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>

    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/syntax.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/styles/foundation.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>


<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">LOB.DATA</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Blog</a>
                    </li>
                    
                    <li>
                        <a href="/categories/aplica%C3%A7%C3%B5es">aplicações</a>
                    </li>
                    
                    <li>
                        <a href="/categories/projetos">projetos</a>
                    </li>
                    
                    <li>
                        <a href="/categories/tutorials">tutorials</a>
                    </li>
                    

		    
                        <li><a href="/top/about/">About Me</a></li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/post_0_4.png')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/restfull-api" title="RESTFull API">
                            RESTFull API
                        </a>
                        
                        <a class="tag" href="/tags/web-development" title="Web Development">
                            Web Development
                        </a>
                        
                        <a class="tag" href="/tags/backend" title="Backend">
                            Backend
                        </a>
                        
                        <a class="tag" href="/tags/asynchronous" title="Asynchronous">
                            Asynchronous
                        </a>
                        
                        <a class="tag" href="/tags/fastapi" title="FastAPI">
                            FastAPI
                        </a>
                        
                        <a class="tag" href="/tags/docker" title="Docker">
                            Docker
                        </a>
                        
                        <a class="tag" href="/tags/sqlalchemy" title="SQLAlchemy">
                            SQLAlchemy
                        </a>
                        
                    </div>
                    <h1>Criando uma API Pronta para Produção com FastAPI - PT.4</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
			Posted by
			
			    Luciano
			
			on
			Thursday, April 8, 2021
                        
                            <span id="/2021/04/08/criando-uma-api-pronta-para-produ%C3%A7%C3%A3o-com-fastapi-pt.4/" class="leancloud_visitors meta_data_item" data-flag-title="">
    <span class="post-meta-item-icon">
      <span class="octicon octicon-eye"></span> 
    </span>
    <i class="fa fa-eye"></i>
    <span class="old-visitors-count" style="display: none;"></span>
    <span class="leancloud-visitors-count"></span>
</span>



<script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>

<script>
	AV.initialize("", "");
</script>

<script type="text/javascript">
function showTime(Counter) {
    var query = new AV.Query(Counter);
    var entries = [];
    var $visitors = $(".leancloud_visitors");

    $visitors.each(function() {
        entries.push($(this).attr("id").trim());
    });

    query.containedIn('url', entries);
    query.find()
        .done(function(results) {
            var COUNT_CONTAINER_REF = '.leancloud-visitors-count';
            var OLD_COUNT_CONTAINER_REF = '.old-visitors-count';

            
            
            
            

            for (var i = 0; i < results.length; i++) {
                var item = results[i];
                var url = item.get('url');
                var time = item.get('time');
                var element = document.getElementById(url);

                $(element).find(COUNT_CONTAINER_REF).text(time);
            }
            for (var i = 0; i < entries.length; i++) {
                var url = entries[i];
                var element = document.getElementById(url);
                var countSpan = $(element).find(COUNT_CONTAINER_REF);
                if (countSpan.text() == '') {
                    var oldCountSpan = $(element).find(OLD_COUNT_CONTAINER_REF).text();
                    if(oldCountSpan!=''){
                        countSpan.text(0+parseInt(oldCountSpan));
                    }else{
                        countSpan.text(0);          
                    }
                }
            }
        })
        .fail(function(object, error) {
            console.log("Error: " + error.code + " " + error.message);
        });
}

function addCount(Counter) {
    var $visitors = $(".leancloud_visitors");
    var url = $visitors.attr('id').trim();
    var title = $visitors.attr('data-flag-title').trim();
    var query = new AV.Query(Counter);

    query.equalTo("url", url);
    query.find({
        success: function(results) {
            if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment("time");
                counter.save(null, {
                    success: function(counter) {
                        var $element = $(document.getElementById(url));
                        $element.find('.leancloud-visitors-count').text(counter.get('time'));
                    },
                    error: function(counter, error) {
                        console.log('Failed to save Visitor num, with error message: ' + error.message);
                    }
                });
            } else {
                var newcounter = new Counter();
                 
                var acl = new AV.ACL();
                acl.setPublicReadAccess(true);
                acl.setPublicWriteAccess(true);
                newcounter.setACL(acl);
                 
                newcounter.set("title", title);
                newcounter.set("url", url);
                var OLD_COUNT_CONTAINER_REF = '.old-visitors-count';
                var $element = $(document.getElementById(url));
                var oldCountSpan = $element.find(OLD_COUNT_CONTAINER_REF).text();
                if(oldCountSpan!=''){
                    newcounter.set("time", parseInt(oldCountSpan)+1);
                }else{
 	                    newcounter.set("time",  1);
                }
                newcounter.save(null, {
                    success: function(newcounter) {
                        var $element = $(document.getElementById(url));
                        $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
                    },
                    error: function(newcounter, error) {
                        console.log('Failed to create');
                    }
                });
            }
        },
        error: function(error) {
            console.log('Error:' + error.code + " " + error.message);
        }
    });
}
$(function() {
    var Counter = AV.Object.extend("Counter");
    
    
    if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
    } else {
        showTime(Counter);
    }
});
</script>

                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    <h3>Table of Contents</h3>
                </header>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#configurando-o-mysql">Configurando o MySQL</a></li>
    <li><a href="#conectando-ao-mysql">Conectando ao MySQL</a>
      <ul>
        <li><a href="#passo-a-passo">Passo a Passo</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#como-funciona-o-sqlalchemy-omr">Como funciona o SQLAlchemy OMR?</a></li>
  </ul>
</nav>
                
                <h1 id="nos-capítulos-anteriores-">Nos Capítulos Anteriores &hellip;</h1>
<p>Após um tempinho sem postar nada, vamos dar continuidade a essa série sobre como desenvolver uma API pronta pro Deploy! 🚀 🚀</p>
<p>Essa é a parte 4 do nosso projeto do <strong>EconoWallet</strong> e se você quiser verificar o que já fizemos até o momento, acesse os links abaixo:</p>
<ul>
<li><a href="https://www.lobdata.com.br/post/finance_control_app/">Parte 1</a></li>
<li><a href="https://www.lobdata.com.br/post/econowallet-fastapi-pt2/">Parte 2</a></li>
<li><a href="https://www.lobdata.com.br/2021/04/08/criando-uma-api-pronta-para-produ%C3%A7%C3%A3o-com-fastapi-pt.3/">Parte 3</a></li>
</ul>
<p>Dando continuidade a nossa aplicação, hoje vamos configurar qual será nosso banco de dados. Apesar de ter tido que nesse post iríamos também configurar o SQLAlchemy, prefirir deixar pro próximo post, pois iria ficar muito conteúdo nesse artigo.</p>
<p><img src="/img/finance_app_tutorial/pt4/areYouReady.gif" alt="I&rsquo;m ready when you are"></p>
<h1 id="modificações">Modificações</h1>
<p>Eu fiz algumas modificações de localização de arquivos de uma forma que fica simples a separação de competências do nosso app. Basicamente agora temos tudo que diz respeito às configurações do Docker (<code>Dockerfile</code>, <code>docker-compose</code>, <code>.dockerignore</code>) fora do diretório do projeto. Veja o resultado:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">.
├── docker-compose.yml
├── Dockerfile
├── Pipfile
├── Pipfile.lock
├── project
│   └── app
│       ├── config.py
│       ├── __init__.py
│       └── main.py
└── README.md
</code></pre></div><p>E além de alterar a localização dos arquivos, foi preciso fazer um pequeno ajuste no <code>docker-compose.yml</code> para referenciar o Dockerfile no root do projeto.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#75715e"># modified</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>version: <span style="color:#e6db74">&#39;3.8&#39;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>services:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  web:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    build: .<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    command: uvicorn app.main:app --reload --workers <span style="color:#ae81ff">1</span> --host 0.0.0.0 --port <span style="color:#ae81ff">8000</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    volumes:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - ./project:/usr/src/app<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    ports:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - 8004:8000<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    environment:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - ENVIRONMENT<span style="color:#f92672">=</span>dev<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - TESTING<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Agora provavelmente tudo deve estar funcionando normalmente. Build novamente e tente acessar o <a href="http://127.0.0.1:8004/docs/">swager da API</a> (<code>docker-compose up --build -d</code>).</p>
<h1 id="database">Database</h1>
<p>Nossa intenção durante o desenvolvimento é buscar ao máximo que nosso ambiente se assemelhe ao ambiente de produção, onde nossa API vai estar sendo acessada por usuários reais. Nesse cenário, as informações trafegadas precisam ser persistidas em algum lugar, e normalmente é nesse ponto onde o banco de dados se encaixa.</p>
<p>Saiba que existem diferentes banco de dados para diferentes tipos de problemas, para nossa aplicação iremos utilizar o <strong>MySQL</strong>.</p>
<h2 id="configurando-o-mysql">Configurando o MySQL</h2>
<p>É realmente muito simples configurar suporte à uma base de dados à sua aplicação utilizando o <strong>docker-compose</strong>. Tudo que você precisa fazer é adicionar mais um <em>service</em>, veja:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile">version: <span style="color:#e6db74">&#39;3.8&#39;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>services:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  web:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    build: .<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    command: uvicorn app.main:app --reload --workers <span style="color:#ae81ff">1</span> --host 0.0.0.0 --port <span style="color:#ae81ff">8000</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    volumes:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - ./project:/usr/src/app<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    ports:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - 8004:8000<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    environment:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - ENVIRONMENT<span style="color:#f92672">=</span>dev<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - TESTING<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e"># new</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    depends_on:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - db<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#75715e"># new</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  db:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    image: mysql:8.0<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    command: --default-authentication-plugin<span style="color:#f92672">=</span>mysql_native_password<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    restart: always<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    volumes:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - mysql_data:/var/lib/mysql_data/data/<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    environment:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      MYSQL_DATABASE: econowallet<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      MYSQL_USER: user<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      MYSQL_PASSWORD: password<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      MYSQL_ROOT_PASSWORD: password<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    ports:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - 3320:3306<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>volumes:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  mysql_data:<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>O que está acontecendo aqui é bem semelhante ao serviço <code>web</code>, com algumas ressalvas:</p>
<ul>
<li><code>depends_on</code>: aqui é utilizado pois agora o nosso serviço <code>web</code> depende que o <code>db</code> esteja pronto primeiro, antes de iniciar.</li>
<li>estamos partindo de uma imagem base <a href="https://hub.docker.com/_/mysql">oficial</a> do MySQL.</li>
<li><code>command</code> e <code>restart</code> são instruções oficiais da imagem do MySQL, doc acima 👆.</li>
</ul>
<p>Além disso, agora precisamos especificar algumas variáveis de ambiente que serão utilizadas para criar nossa base de dados para o <strong>EconoWallet</strong> e a porta que iremos nos conectar para acessar as informações. E, como para nosso banco de dados estamos especificando um volume que não é um diretório, o mesmo precisa ser indicado ao final do <code>docker-compose.yml</code>.</p>
<h2 id="conectando-ao-mysql">Conectando ao MySQL</h2>
<p>Agora que nosso <code>docker-compose.yml</code> está configurado, podemos rebuildar nossa aplicação, eu gosto de <em>derrubar</em> o serviço removendo os volumes sempre que tem uma modificação relativamente grande, e em seguida <em>subir</em> novamente.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker-compose down -v
docker-compose up --build -d
</code></pre></div><p>Você pode também consultar os logs para saber se tudo correu bem, basta rodar <code>docker-compose logs -f</code>. Se tudo correu bem você já está apto a conectar no nosso banco de dados.</p>
<p>Se você tem uma versão premium do PyCharm é bem simples de fazer isso, mas aqui eu mostrarei como configurar pelo <strong>DBeaver</strong> um software gratuito e todos tem acesso.</p>
<p><img src="/img/finance_app_tutorial/pt4/dbeaver.png" alt="DBeaver"></p>
<p>Aqui tem o <a href="https://dbeaver.io">link oficial</a> do site deles, a instalação é super direta para qualquer SO.</p>
<h3 id="passo-a-passo">Passo a Passo</h3>
<ol>
<li>Com o software instalado, vá na lateral superior esquerda e clique no símbolo de uma tomada:</li>
</ol>
<p><img src="/img/finance_app_tutorial/pt4/dbeaver-1.png" alt="DBeaver"></p>
<ol start="2">
<li>
<p>Agora você vai precisar preencher os campos as informações que estão no <code>docker-compose.yml</code> e clicar em <strong>Test connection</strong>.
<img src="/img/finance_app_tutorial/pt4/dbeaver-2.png" alt="DBeaver"></p>
</li>
<li>
<p>Provavelmente ele vai solicitar instalar alguns drives e se tudo correr bem verá uma mensagem como no print.
<img src="/img/finance_app_tutorial/pt4/dbeaver-3.png" alt="DBeaver"></p>
</li>
<li>
<p>Clique em finish e na lateral agora você deve estar vendo nosso banco já configurado!! ✨ :sparkles:
<img src="/img/finance_app_tutorial/pt4/dbeaver-4.png" alt="DBeaver"></p>
</li>
</ol>
<p>Apesar de estarmos com nosso banco configurado, ainda não temos nenhuma tabela para interagir e também não temos nenhuma interação entre a API e o banco. <strong>SQLAlchemy ao resgate!!</strong></p>
<h1 id="sqlalchemy">SQLAlchemy</h1>
<p><img src="/img/finance_app_tutorial/pt4/sqlalchemy.png" alt="SQLAlchemy"></p>
<p><strong>SQLAlchemy</strong> faz parte de um conjunto de frameworkers que são utilizados para abstrair a complexidade de lidar com o banco de dados diretamente. Desenvolver com um ORM não te prende à um banco de dados específico, onde posteriormente é possível plugar a aplicação ao Postgres, MySQL, Oracle, MariaDB ou outros (contanto que o framework tenha suporte). Escolhi o <strong>SQLAlchemy</strong> por alguns motivos:</p>
<ul>
<li>pela robustes: o SQLAlchemy possui diferentes módulos (Core e ORM) que te permite fazer muita coisa legal.</li>
<li>muito tempo presente na comunidade: o que torna mais fácil lidar com problemas e bugs caso eles apareçam (e irão aparecer =D).</li>
<li>ter sido bastante utilizado e testado em produção: isso atribui maior confiabilidade ao software.</li>
</ul>
<p>Saiba que o <code>SQLAlchemy</code> está sendo atualizado e parte da sintaxe de como realizar queries no banco irá mudar, apesar dessa nova sintaxe estar disponível na versão atual da lib ela ainda não está oficialmente lançada, para mais detalhes acesse a <a href="https://www.sqlalchemy.org">documentação</a>. Aqui iremos utilizar a sintaxe mais tradicional.</p>
<h2 id="como-funciona-o-sqlalchemy-omr">Como funciona o SQLAlchemy OMR?</h2>
<p>É importante deixar claro que aqui nós estamos utilizando o componente ORM do SQLAlchemy e não o Core. A diferença é que o ORM adiciona uma camada de abstração que torna a interação com o banco mais <em>pythonica</em> e menos <em>SQL raiz</em>.</p>
<p>Minha intenção não é explicar todos os detalhes do SQLAlchemy, mas sim o de ajudar a compreender os componentes que iremos utilizar aqui. Existe um livro muito bom com várias informações super relevantes chamado <a href="https://www.amazon.com.br/Essential-SQLAlchemy-Rick-Copeland/dp/0596516142">Essential SQLAlchemy</a>.</p>
<p>Dito isso, eu costumo pensar o SQLAlchemy como duas sessões diferentes:</p>
<ol>
<li>A primeira onde especificamos quais os <strong>models</strong> (traduzidos em tabelas do banco) da nossa aplicação.</li>
<li>E o segundo onde especificamos a <strong>session</strong> (conexão com o banco).</li>
</ol>
<p>No diagrama abaixo eu tento ilustrar esses dois cenários:</p>
<ol>
<li>Cenário Um</li>
</ol>
<p><img src="/img/finance_app_tutorial/pt4/sqlal-1.png" alt="SQLAlchemy Explain"></p>
<p>Veja que partimos de uma classe mãe chamada de <code>declarative_base</code> pelo SQLAlchemy e que a mesma é utilizada na criação de cada um dos models. Além disso, após configurados os models, nós utilizamos o <code>.metadata.create_all(engine)</code> para de fato materializar esses models em tabelas no banco. Essa <strong>engine</strong> é justamente onde está a informação de qual banco de dados utilizar.</p>
<ol>
<li>Cenário Dois</li>
</ol>
<p><img src="/img/finance_app_tutorial/pt4/sqlal-2.png" alt="SQLAlchemy Explain"></p>
<p>Aqui nós vemos como é feita a conexão com o banco e é por meio da session que faremos transações com as nossas tabelas criadas, o famoso <strong>C</strong>reate/<strong>R</strong>ead/<strong>U</strong>pdate/<strong>D</strong>elete. Um ponto para ficar atento é que ao configurar as sessions na nossa aplicação precisamos cuidar para que as sessions sejam sempre finalizadas, mesmo quando algum problema aconteça.</p>
<p>IMAGEM SOMEONE ACCOMPLISH SOMETHIHNG!</p>
<h1 id="próximo-capítulo">Próximo Capítulo&hellip;</h1>
<p>Na próxima etapa, iremos configurar o <strong>SQLAlchemy</strong> e fazer com que nosso app comece a interagir com o banco!!</p>
<p>Você pode acompanhar o repositório do projeto no link abaixo:</p>
<ul>
<li><a href="https://github.com/LucianoBatista/econowallet">GitHub - Econowallet</a> 🥂</li>
</ul>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2021/04/08/criando-uma-api-pronta-para-produ%C3%A7%C3%A3o-com-fastapi-pt.5/" data-toggle="tooltip" data-placement="top" title="Criando uma API Pronta para Produção com FastAPI - PT.5">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2021/04/08/criando-uma-api-pronta-para-produ%C3%A7%C3%A3o-com-fastapi-pt.3/" data-toggle="tooltip" data-placement="top" title="Criando uma API Pronta para Produção com FastAPI - PT.3">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/asynchronous" title="asynchronous">
                            asynchronous
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/backend" title="backend">
                            backend
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/data-science" title="data-science">
                            data-science
                        </a>
                        
                        
                        
                        <a href="/tags/data-visualization" title="data-visualization">
                            data-visualization
                        </a>
                        
                        
                        
                        <a href="/tags/docker" title="docker">
                            docker
                        </a>
                        
                        
                        
                        <a href="/tags/fastapi" title="fastapi">
                            fastapi
                        </a>
                        
                        
                        
                        <a href="/tags/ggplot2" title="ggplot2">
                            ggplot2
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/machine-learning" title="machine-learning">
                            machine-learning
                        </a>
                        
                        
                        
                        <a href="/tags/project" title="project">
                            project
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/r" title="r">
                            r
                        </a>
                        
                        
                        
                        <a href="/tags/restfull-api" title="restfull-api">
                            restfull-api
                        </a>
                        
                        
                        
                        <a href="/tags/sqlalchemy" title="sqlalchemy">
                            sqlalchemy
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/time-series" title="time-series">
                            time-series
                        </a>
                        
                        
                        
                        <a href="/tags/web-development" title="web-development">
                            web-development
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="LOB.DATA" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/LucianoBatista">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		                
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/lucianobatistads/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		                
                    
                </ul>
		<p class="copyright text-muted">
                    A <a href="https://gohugo.io/">HUGO</a> <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite</a> page build with ♥ and powered by <a href="https://www.netlify.com/">Netlify</a>&nbsp;&nbsp;&bull;&nbsp;&nbsp;Header images by <a href="https://www.pexels.com/photo/climate-sea-landscape-nature-35626/">Pexels</a>
    </p>
    <p class="copyright text-muted" style='font-size:8pt;'>
                    &copy; LOB.DATA 2019–2021. All rights reserved.&nbsp;&nbsp;&bull;&nbsp;&nbsp;<a href="https://lobdata.com.br/top/conduct/">Code of Conduct</a>
                    <br>
                    Content on this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International license</a>.
                    <br>
                    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#28a87d'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-5NWJ42KMKC', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
</html>
